<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Карта объектов — TDA‑AGENT</title>
  <meta name="description" content="Карта объектов недвижимости: фильтр по цене, комнатам, району, площади и срокам сдачи."/>
  <style>
    :root { --bg1:#070b14; --bg2:#0b1324; --panel:rgba(255,255,255,.04); --stroke:rgba(255,255,255,.14);
            --text:#e6edf7; --muted:#9fb3d9; --accent:#5eead4; --violet:#8b5cf6; }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:radial-gradient(900px 600px at 20% 10%, #0f172a, var(--bg1)) fixed,
                                      radial-gradient(1000px 700px at 80% 90%, #111827, var(--bg2)) fixed;
              color:var(--text);font:16px/1.55 system-ui,-apple-system,Segoe UI,Inter,Roboto,Arial,sans-serif;scroll-behavior:smooth;overflow-x:hidden}
    a{color:var(--accent);text-decoration:none}
    .container{width:min(1100px,92vw);margin:0 auto}
    nav{position:sticky;top:0;z-index:50;background:linear-gradient(180deg, rgba(7,11,20,.85), rgba(7,11,20,.55));backdrop-filter: blur(8px);
        border-bottom:1px solid var(--stroke)}
    nav .container{width:100%;max-width:100vw}
    .nav-wrap{display:grid;grid-template-columns:auto 1fr auto;align-items:center;gap:12px;padding:10px 18px}
    .brand{font-weight:900;letter-spacing:.08em;-webkit-text-stroke:1.5px #9fb3d9;color:transparent;filter:drop-shadow(0 0 12px rgba(94,234,212,.45)) drop-shadow(0 0 26px rgba(139,92,246,.35))}
    .menu{display:flex;gap:14px;flex-wrap:nowrap;justify-content:space-evenly;flex:1}
    .menu a{position:relative;flex:1 1 auto;text-align:center;padding:10px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.14);
            background:radial-gradient(120% 140% at 50% 50%, rgba(94,234,212,.08), rgba(139,92,246,.06));
            color:var(--text);transform-style:preserve-3d;transition:transform .2s ease, box-shadow .2s ease, text-shadow .2s ease, background .2s ease, border-color .2s ease;
            text-shadow:0 0 10px rgba(94,234,212,.6),0 0 22px rgba(94,234,212,.45),0 0 42px rgba(139,92,246,.35);
            box-shadow:0 0 12px rgba(94,234,212,.30),0 0 26px rgba(139,92,246,.25),inset 0 0 12px rgba(94,234,212,.18);
            transform:translateZ(var(--tz,0px)) rotateX(var(--rx,0deg)) rotateY(var(--ry,0deg))}
    .menu a:hover{--tz:18px;border-color:rgba(94,234,212,.6);background:radial-gradient(120% 140% at 50% 50%, rgba(94,234,212,.18), rgba(139,92,246,.14));
                  text-shadow:0 0 14px rgba(94,234,212,.9),0 0 34px rgba(94,234,212,.75),0 0 64px rgba(34,211,238,.6),0 0 96px rgba(139,92,246,.55);
                  box-shadow:0 0 18px rgba(94,234,212,.65),0 0 40px rgba(139,92,246,.55),inset 0 0 18px rgba(94,234,212,.28)}
    .menu a.active{border-color:rgba(94,234,212,.5);background:linear-gradient(135deg, rgba(94,234,212,.22), rgba(139,92,246,.22));
                   text-shadow:0 0 16px rgba(94,234,212,.95),0 0 40px rgba(34,211,238,.7),0 0 80px rgba(139,92,246,.6)}

    .map-wrap{height:68vh;min-height:460px;border-bottom:1px solid var(--stroke)}
    #map{width:100%;height:100%}

    .filters{padding:16px;background:var(--panel);border:1px solid var(--stroke);border-radius:14px;display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px;margin:16px 0;backdrop-filter:blur(6px)}
    .filters label{display:flex;flex-direction:column;gap:6px;color:var(--muted);font-size:14px}
    .filters input,.filters select{padding:10px 12px;border-radius:10px;border:1px solid var(--stroke);background:#0b1020;color:var(--text)}
    .filters .actions{display:flex;gap:8px}
    .btn{padding:10px 14px;border-radius:12px;background:linear-gradient(135deg, rgba(94,234,212,.2), rgba(139,92,246,.2));
         border:1px solid var(--stroke);color:var(--text);transition:.2s ease;display:inline-flex;gap:8px;align-items:center}
    .btn:hover{transform:translateY(-1px)}

    .balloon{display:grid;grid-template-columns:140px 1fr;gap:10px;align-items:start}
    .balloon img{width:140px;height:100px;object-fit:cover;border-radius:8px;border:1px solid var(--stroke)}
    .balloon .price{font-weight:700;color:#a7f3d0}
    footer{padding:24px 0;text-align:center;color:var(--muted)}
  </style>
  <script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU"></script>
</head>
<body>
  <canvas id="neuro"></canvas>
  <nav>
    <div class="container nav-wrap">
      <div class="brand">TDA‑AGENT</div>
      <div class="menu" id="menu"><a href="index.html#hero">Главная</a><a href="index.html#services">Услуги</a><a class="active" href="map.html">Карта объектов</a><a href="index.html#about">О продукте</a></div>
      <div></div>
    </div>
  </nav>

  <main class="container">
    <section class="map-wrap">
      <div id="map" aria-label="Карта объектов"></div>
    </section>

    <section class="filters" id="filters">
      <label>Цена, от (₽)
        <input type="number" id="priceMin" placeholder="Напр. 5 000 000" />
      </label>
      <label>Цена, до (₽)
        <input type="number" id="priceMax" placeholder="Напр. 25 000 000" />
      </label>
      <label>Комнат
        <select id="rooms">
          <option value="">Любое</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4+">4+</option>
        </select>
      </label>
      <label>Район
        <select id="district">
          <option value="">Любой</option>
        </select>
      </label>
      <label>Площадь, от (м²)
        <input type="number" id="areaMin" placeholder="Напр. 35" />
      </label>
      <label>Площадь, до (м²)
        <input type="number" id="areaMax" placeholder="Напр. 120" />
      </label>
      <label>Срок
        <select id="deadline">
          <option value="">Любой</option>
          <option value="completed">Сданные</option>
          <option value="q1-2025">До 1 кв. 2025</option>
          <option value="q2-2025">До 2 кв. 2025</option>
          <option value="q3-2025">До 3 кв. 2025</option>
          <option value="q4-2025">До 4 кв. 2025</option>
          <option value="q1-2026">До 1 кв. 2026</option>
          <option value="q2-2026">До 2 кв. 2026</option>
          <option value="q3-2026">До 3 кв. 2026</option>
          <option value="q4-2026">До 4 кв. 2026</option>
          <option value="q1-2027">До 1 кв. 2027</option>
          <option value="q2-2027">До 2 кв. 2027</option>
          <option value="q3-2027">До 3 кв. 2027</option>
          <option value="q4-2027">До 4 кв. 2027</option>
          <option value="q1-2028">До 1 кв. 2028</option>
          <option value="q2-2028">До 2 кв. 2028</option>
          <option value="q3-2028">До 3 кв. 2028</option>
          <option value="q4-2028">До 4 кв. 2028</option>
          <option value="q1-2029">До 1 кв. 2029</option>
          <option value="q2-2029">До 2 кв. 2029</option>
          <option value="q3-2029">До 3 кв. 2029</option>
          <option value="q4-2029">До 4 кв. 2029</option>
        </select>
      </label>
      <div class="actions">
        <button class="btn" id="apply">Применить</button>
        <button class="btn" id="reset">Сбросить</button>
      </div>
    </section>
  </main>

  <footer>
    <div class="container"><p>&copy; TDA‑AGENT. Карта объектов.</p></div>
  </footer>

  <script>
    // -------- Neural Network Canvas (фон) --------
    const c = document.getElementById('neuro');
    const ctx = c.getContext('2d');
    let W,H,mouseX=0,mouseY=0, nodes=[], edges=[];
    const CFG = { count: 120, maxDist: 160, parallax: 30, seedEdges: 2, maxEdgesPerNode: 6 };

    function resize(){
      const dpr = Math.min(2, (window.devicePixelRatio||1));
      W = innerWidth; H = innerHeight;
      c.width = Math.floor(W*dpr); c.height = Math.floor(H*dpr);
      c.style.width = W+'px'; c.style.height = H+'px';
      ctx.setTransform(dpr,0,0,dpr,0,0);
      if (!nodes.length) init();
    }
    addEventListener('resize', resize);

    function rand(a,b){ return Math.random()*(b-a)+a }
    function dist(a,b){ const dx=a.x-b.x, dy=a.y-b.y; return Math.hypot(dx,dy) }
    function init(){
      nodes = Array.from({length:CFG.count}, ()=> ({ x: rand(0,W), y: rand(0,H), vx: rand(-.2,.2), vy: rand(-.2,.2), r: rand(1.2,2.4), e: 0, pulse: rand(0, 2*Math.PI) }));
      edges = [];
      for (let i=0;i<nodes.length;i++){
        for (let j=i+1;j<nodes.length && nodes[i].e<CFG.seedEdges;j++){
          const d = dist(nodes[i], nodes[j]);
          if (d < CFG.maxDist*0.6){ addEdge(i,j, Math.random()*0.6); }
        }
      }
    }
    function addEdge(i,j, life=0){
      if (nodes[i].e>=CFG.maxEdgesPerNode || nodes[j].e>=CFG.maxEdgesPerNode) return;
      edges.push({i,j, life}); nodes[i].e++; nodes[j].e++;
    }
    addEventListener('mousemove', e=>{ mouseX = (e.clientX - W/2)/W; mouseY = (e.clientY - H/2)/H; });

    function step(dt){
      for (const n of nodes){
        n.x += n.vx * dt * 0.06; n.y += n.vy * dt * 0.06;
        if (n.x < -50) n.x = W+50; if (n.x > W+50) n.x = -50;
        if (n.y < -50) n.y = H+50; if (n.y > H+50) n.y = -50;
        n.pulse += dt*0.004;
      }
      for (let e of edges){ e.life = Math.min(1, e.life + dt*0.0006) }
      for (let k=0; k<60; k++){
        const i = (Math.random()*nodes.length)|0;
        const j = (Math.random()*nodes.length)|0;
        if (i===j) continue;
        if (nodes[i].e>=CFG.maxEdgesPerNode) continue;
        if (nodes[j].e>=CFG.maxEdgesPerNode) continue;
        const d = dist(nodes[i], nodes[j]);
        if (d < CFG.maxDist && Math.random() < 0.006){ addEdge(i,j, 0); }
      }
    }

    function draw(t){
      const dt = draw.prev ? Math.min(32, t - draw.prev) : 16; draw.prev = t;
      step(dt);
      ctx.clearRect(0,0,W,H);
      const grad = ctx.createRadialGradient(W*0.2, H*0.1, 100, W*0.8, H*0.9, Math.hypot(W,H));
      grad.addColorStop(0,'rgba(94,234,212,0.06)'); grad.addColorStop(1,'rgba(17,24,39,0.0)');
      ctx.fillStyle = grad; ctx.fillRect(0,0,W,H);
      ctx.lineWidth = 1.2;
      for (const e of edges){
        const a = nodes[e.i], b = nodes[e.j];
        const px = (mouseX*CFG.parallax), py = (mouseY*CFG.parallax);
        ctx.strokeStyle = `rgba(159,179,217,${0.22*e.life})`;
        ctx.beginPath(); ctx.moveTo(a.x+px, a.y+py); ctx.lineTo(b.x+px, b.y+py); ctx.stroke();
        const s = (Math.sin(t*0.003 + (a.x+b.x)) + 1)/2 * e.life;
        const sx = a.x + (b.x-a.x)*s + px, sy = a.y + (b.y-a.y)*s + py;
        ctx.fillStyle = `rgba(94,234,212,${0.25*e.life})`; ctx.beginPath(); ctx.arc(sx, sy, 2, 0, Math.PI*2); ctx.fill();
      }
      for (const n of nodes){
        const px = (mouseX*CFG.parallax), py = (mouseY*CFG.parallax);
        const rr = n.r + Math.sin(n.pulse)*0.5;
        ctx.fillStyle = 'rgba(139,92,246,0.28)'; ctx.beginPath(); ctx.arc(n.x+px, n.y+py, rr+1.2, 0, Math.PI*2); ctx.fill();
        ctx.fillStyle = 'rgba(94,234,212,0.9)'; ctx.beginPath(); ctx.arc(n.x+px, n.y+py, rr, 0, Math.PI*2); ctx.fill();
      }
      requestAnimationFrame(draw);
    }
    // Пример данных — замените на реальные
    // Метки отключены — список пустой, подключите позже из БД/админки
    const LISTINGS = [];

    function formatPrice(v){ return new Intl.NumberFormat('ru-RU').format(v) }
    function deadlineLabel(d){
      if (!d) return "";
      if (d.status === 'completed') return 'Сдан';
      return `До ${d.q} кв. ${d.y}`;
    }
    function deadlineWithin(d, q, y){
      if (!d) return false;
      if (d.status === 'completed') return true;
      if (d.y < y) return true;
      if (d.y === y && d.q <= q) return true;
      return false;
    }

    let map, clusterer, placemarks = [];
    function initMap(){
      map = new ymaps.Map('map', { center:[55.751574,37.573856], zoom:10, controls:['zoomControl','typeSelector','geolocationControl','searchControl'] });
      clusterer = new ymaps.Clusterer({ preset:'islands#invertedVioletClusterIcons', groupByCoordinates:false });
      placemarks = [];// Пока метки отключены
      // Для будущего: раскомментируйте создание меток и добавление кластера
      // placemarks = LISTINGS.map(item => new ymaps.Placemark(item.coords, { ... }, { preset:'islands#violetIcon' }));
      // placemarks.forEach((pm, i)=>{ pm.item = LISTINGS[i]; });
      // clusterer.add(placemarks);
      map.geoObjects.add(clusterer);
      fillDistricts();
    }

    function fillDistricts(){
      const sel = document.getElementById('district');
      const uniq = Array.from(new Set(LISTINGS.map(l=>l.district))).sort();
      uniq.forEach(d=>{ const o = document.createElement('option'); o.value=d; o.textContent=d; sel.appendChild(o); });
    }

    function applyFilter(){
      const priceMin = parseInt(document.getElementById('priceMin').value||'0',10);
      const priceMax = parseInt(document.getElementById('priceMax').value||'0',10);
      const rooms = document.getElementById('rooms').value;
      const district = document.getElementById('district').value;
      const areaMin = parseInt(document.getElementById('areaMin').value||'0',10);
      const areaMax = parseInt(document.getElementById('areaMax').value||'0',10);
      const deadline = document.getElementById('deadline').value; // e.g. "q4-2029" or "completed"

      let qTarget = null, yTarget = null;
      if (deadline && deadline !== 'completed'){
        const [q,y] = deadline.split('-'); qTarget = parseInt(q.replace('q',''),10); yTarget = parseInt(y,10);
      }

      const pass = (it)=>{
        if (priceMin && it.price < priceMin) return false;
        if (priceMax && it.price > priceMax) return false;
        if (rooms){ if (rooms === '4+' && it.rooms < 4) return false; if (rooms !== '4+' && it.rooms !== parseInt(rooms,10)) return false; }
        if (district && it.district !== district) return false;
        if (areaMin && it.area < areaMin) return false;
        if (areaMax && it.area > areaMax) return false;
        if (deadline){ if (deadline === 'completed') { if (it.deadline?.status !== 'completed') return false; } else { if (!deadlineWithin(it.deadline, qTarget, yTarget)) return false; } }
        return true;
      };

      clusterer.removeAll();
      placemarks.forEach(pm=>{ if (pass(pm.item)) clusterer.add(pm); });
    }

    function resetFilter(){
      document.getElementById('priceMin').value = '';
      document.getElementById('priceMax').value = '';
      document.getElementById('rooms').value = '';
      document.getElementById('district').value = '';
      document.getElementById('areaMin').value = '';
      document.getElementById('areaMax').value = '';
      document.getElementById('deadline').value = '';
      clusterer.removeAll();
      clusterer.add(placemarks);
    }

    document.addEventListener('DOMContentLoaded', ()=>{
      if (window.ymaps){ ymaps.ready(initMap); }
      document.getElementById('apply').addEventListener('click', applyFilter);
      document.getElementById('reset').addEventListener('click', resetFilter);

      // 3D-tilt и неон для пунктов меню и кнопок
      function enableTiltNeon(selector){
        document.querySelectorAll(selector).forEach(el=>{
          el.addEventListener('mousemove',(e)=>{
            const r = el.getBoundingClientRect();
            const x = (e.clientX - r.left)/r.width - 0.5;
            const y = (e.clientY - r.top)/r.height - 0.5;
            el.style.setProperty('--rx', (-y*10).toFixed(2)+'deg');
            el.style.setProperty('--ry', (x*10).toFixed(2)+'deg');
            el.style.setProperty('--tz','18px');
          });
          el.addEventListener('mouseleave',()=>{
            el.style.setProperty('--rx','0deg');
            el.style.setProperty('--ry','0deg');
            el.style.setProperty('--tz','0px');
          });
        });
      }
      enableTiltNeon('.menu a');
      enableTiltNeon('.btn');
    });
  </script>
</body>
</html>
    /* Глобальная анимация — фон */
    #neuro{position:fixed;inset:0;z-index:0;pointer-events:none}
    body > *{position:relative;z-index:1}